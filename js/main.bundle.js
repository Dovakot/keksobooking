(()=>{"use strict";const e={ROOM:["комната","комнаты","комнат"],GUEST:["гостя","гостей","гостей"]},t=(t,r=1)=>{const o=e[t];let n=o[2];return 1===r?n=o[0]:r>1&&r<5&&(n=o[1]),`${r} ${n}`},r="https://22.javascript.pages.academy/keksobooking/",o=({status:e,statusText:t})=>{throw new Error(`${e} ${t}`)},n=document.querySelector(".map__filters"),a=n.children,c=n.querySelector("#housing-type"),s=n.querySelector("#housing-price"),d=n.querySelector("#housing-rooms"),l=n.querySelector("#housing-guests"),i=n.querySelector("#housing-features"),u=({value:e},t)=>"any"===e||t===("number"==typeof t?+e:e),p={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},m={lat:35.68951,lng:139.69171},y={iconUrl:"./img/pin.svg",iconSize:[36,36],iconAnchor:[18,36]},g=L.map("map-canvas"),h=L.layerGroup(),f=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),v=L.marker(m,{icon:f,zIndexOffset:1e3}),S=e=>{const t=e.target.getLatLng();V(t)},q=()=>{v.dragging.enable(),v.on("moveend",S)},_=e=>{const r=L.icon(y);e.forEach((e=>{const o=(({author:e,offer:r})=>{const o=document.querySelector("#card").content.querySelector(".popup").cloneNode(!0),n=o.querySelector(".popup__title"),a=o.querySelector(".popup__text--address"),c=o.querySelector(".popup__text--price"),s=o.querySelector(".popup__type"),d=o.querySelector(".popup__text--capacity"),l=o.querySelector(".popup__text--time"),i=o.querySelector(".popup__description"),u=o.querySelector(".popup__feature"),m=o.querySelector(".popup__photo"),y=o.querySelector(".popup__avatar");return n.textContent=r.title,a.textContent=r.address,c.textContent=`${r.price} ₽/ночь`,s.textContent=p[r.type],d.textContent=`${t("ROOM",r.rooms)} для ${t("GUEST",r.guests)}`,l.textContent=`Заезд после ${r.checkin}, выезд до ${r.checkout}`,i.textContent=r.description,y.src=e.avatar,u.replaceWith(((e,t)=>{const r=document.createDocumentFragment();for(let o of t){const t=e.cloneNode(!0);t.classList.add(`popup__feature--${o}`),r.appendChild(t)}return r})(u,r.features)),m.replaceWith(((e,t)=>{const r=document.createDocumentFragment();for(let o of t){const t=e.cloneNode(!0);t.src=o,r.appendChild(t)}return r})(m,r.photos)),o})(e),n=L.marker(e.location,{icon:r});n.bindPopup(o),h.addLayer(n)})),h.addTo(g)},E=e=>{const t=(e=>{const t=document.querySelector("#"+e).content.querySelector("."+e).cloneNode(!0),r=e=>!!(e=>"Escape"===e.key||"Esc"===e.key)(e)&&o(),o=()=>{t.remove(),document.removeEventListener("keydown",r)},n=o;return t.addEventListener("click",n),document.addEventListener("keydown",r),t})(e);document.querySelector("main").appendChild(t)},b={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},w=["image/png","image/jpeg"],k={bungalow:0,flat:1e3,house:5e3,palace:1e4},x=document.querySelector(".ad-form"),$=x.children,C=x.querySelector("#address"),T=x.querySelector("#price"),O=x.querySelector("#type"),F=x.querySelector("#timein"),U=x.querySelector("#timeout"),D=x.querySelector("#room_number"),z=x.querySelector("#capacity"),A=x.querySelector("#avatar"),G=x.querySelector("#images"),N=x.querySelector(".ad-form-header__preview img"),R=x.querySelector(".ad-form__photo"),V=({lat:e,lng:t})=>{C.value=`${e.toFixed(5)}, ${t.toFixed(5)}`},j=()=>{const e=k[O.value];T.min=e,T.placeholder=e},M=e=>{E(e),q(),x.classList.remove("ad-form--load")},P=()=>{x.reset(),n.reset(),v.setLatLng(m),B(),H(),setTimeout((()=>{V(m),j()}))},W=()=>{const e=D.value,r=z.value,o=b[e],n=o[o.length-1];if(o.includes(r))D.setCustomValidity("");else{const r="Вариант размещения "+("100"===e?"не для гостей":"вместимостью до "+t("GUEST",n));D.setCustomValidity(r)}D.reportValidity()},I=({target:e},t)=>{const r=e.files[0];if(w.includes(r.type)){const e=new FileReader;e.addEventListener("load",(()=>t(e.result))),e.readAsDataURL(r)}},B=(e="img/muffin-grey.svg")=>{N.src=e},H=e=>{R.style.background=e?`#e4e4de url('${e}') no-repeat center / cover`:"#e4e4de"};var J,K;(()=>{x.classList.add("ad-form--disabled");for(let e of $)e.disabled=!0})(),(()=>{n.classList.add("map__filters--disabled");for(let e of a)e.disabled=!0})(),g.on("load",(()=>{(()=>{x.classList.remove("ad-form--disabled");for(let e of $)e.disabled=!1;const e=P,t=W,n=W,a=j;D.addEventListener("change",t),z.addEventListener("change",n),A.addEventListener("change",(e=>I(e,B))),G.addEventListener("change",(e=>I(e,H))),O.addEventListener("change",a),F.addEventListener("change",(()=>{U.value=F.value})),U.addEventListener("change",(()=>{F.value=U.value})),x.addEventListener("submit",(e=>{var t,n,a;e.preventDefault(),v.dragging.disable(),v.off("moveend",S),x.classList.add("ad-form--load"),t=()=>{M("success"),P()},n=()=>M("error"),a=new FormData(e.target),fetch(r,{method:"POST",body:a}).then((e=>e.ok?t():o(e))).catch(n)})),x.addEventListener("reset",e)})(),V(m)})),g.setView(m,10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(g),v.addTo(g),q(),J=e=>{const t=((e,t)=>{let r;return(...t)=>{clearTimeout(r),r=setTimeout(e,500,...t)}})((()=>{var t;h.clearLayers(),_((t=e,t.filter((e=>{const{type:t,price:r,rooms:o,guests:n,features:a}=e.offer;return u(c,t)&&(e=>{const t=s.value;switch(t){case"low":return e<1e4;case"middle":return e>=1e4&&e<=5e4;case"high":return e>5e4;case"any":return!0;default:throw new Error(`Неизвестное значение: ${t}`)}})(r)&&u(d,o)&&u(l,n)&&(e=>[...i.querySelectorAll("input:checked")].every((t=>e.includes(t.value))))(a)}))).slice(0,10))}));_(e.slice(0,10)),((e,t)=>{n.classList.remove("map__filters--disabled");for(let e of a)e.disabled=!1;n.addEventListener("change",e),n.addEventListener("reset",t)})(t,t)},K=()=>E("request-failed"),fetch(r+"data").then((e=>e.ok?e.json():o(e))).then(J).catch(K)})();
//# sourceMappingURL=main.bundle.js.map