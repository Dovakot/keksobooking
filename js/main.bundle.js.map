{"version":3,"sources":["webpack://keksobooking/./source/js/utils.js","webpack://keksobooking/./source/js/api.js","webpack://keksobooking/./source/js/filter.js","webpack://keksobooking/./source/js/property-card.js","webpack://keksobooking/./source/js/map.js","webpack://keksobooking/./source/js/message.js","webpack://keksobooking/./source/js/form.js","webpack://keksobooking/./source/js/main.js"],"names":["PluralWords","ROOM","GUEST","pluralizeWord","key","count","array","element","SERVER_URL","throwError","status","statusText","Error","filterForm","document","querySelector","filterChildren","children","fieldType","fieldPrice","fieldRooms","fieldGuests","fieldFeatures","filterByValue","value","offer","typeList","flat","bungalow","house","palace","INITIAL_COORDS","lat","lng","PinsSettings","iconUrl","iconSize","iconAnchor","map","L","defaultMarkers","layerGroup","mainPinIcon","icon","mainMarker","marker","zIndexOffset","onMainMarkerMoveend","evt","location","target","getLatLng","setAddress","enableMapMainMarker","dragging","enable","on","addMapMarkers","ads","pinIcon","forEach","ad","card","author","template","content","cloneNode","title","address","price","type","capacity","time","description","feature","photo","avatar","textContent","rooms","guests","checkin","checkout","src","replaceWith","typeFeatures","fragment","createDocumentFragment","featureCopy","classList","add","appendChild","createOfferFeatures","features","linkPhotos","link","photoCopy","createOfferPhotos","photos","bindPopup","addLayer","addTo","showMessage","name","onMessageEscKeydown","isEscEvent","closeMessage","remove","removeEventListener","onMessageClick","addEventListener","createMessage","ROOMS_CAPACITY","FILE_FORMATS","priceList","adForm","fieldsetChildren","fieldAddress","fieldTimein","fieldTimeout","fieldRoomNumber","fieldCapacity","fieldAvatar","fieldPhoto","previewAvatar","previewPhoto","toFixed","setPrice","min","placeholder","submitAd","resetAdForm","reset","setLatLng","setAvatarPreview","setPhotoPreview","setTimeout","checkCapacityRooms","roomNumber","maxGuests","length","includes","setCustomValidity","textError","reportValidity","imageLoad","onLoad","file","files","reader","FileReader","result","readAsDataURL","style","background","onSuccess","onFail","fieldset","disabled","disableAdForm","filter","disableFilterForm","onAdFormReset","onRoomNumberChange","onCapacityChange","onTypeChange","body","preventDefault","disable","off","FormData","fetch","method","then","response","catch","enableAdForm","setView","tileLayer","attribution","data","debouncedRefreshFilterForm","cb","timeout","lastTimeout","args","clearTimeout","debounce","clearLayers","selectedPrice","filterByPrice","querySelectorAll","every","input","filterByFeatures","slice","onChange","onReset","enableFilterForm","json"],"mappings":"mBAAA,MAAMA,EAAc,CAClBC,KAAM,CACJ,UACA,UACA,UAEFC,MAAO,CACL,QACA,SACA,WAIEC,EAAgB,CAACC,EAAKC,EAAQ,KAClC,MAAMC,EAAQN,EAAYI,GAC1B,IAAIG,EAAUD,EAAM,GAQpB,OANc,IAAVD,EACFE,EAAUD,EAAM,GACPD,EAAQ,GAAKA,EAAQ,IAC9BE,EAAUD,EAAM,IAGX,GAAGD,KAASE,KCvBfC,EAAa,oDAEbC,EAAa,EAAEC,SAAQC,iBAC3B,MAAM,IAAIC,MAAM,GAAGF,KAAUC,MCSzBE,EAAaC,SAASC,cAAc,iBACpCC,EAAiBH,EAAWI,SAC5BC,EAAYL,EAAWE,cAAc,iBACrCI,EAAaN,EAAWE,cAAc,kBACtCK,EAAaP,EAAWE,cAAc,kBACtCM,EAAcR,EAAWE,cAAc,mBACvCO,EAAgBT,EAAWE,cAAc,qBAuBzCQ,EAAgB,EAAEC,SAAQC,IAzCb,QA0CVD,GACAC,KAA6B,iBAAVA,GAAuBD,EAAQA,GCzCrDE,EAAW,CACfC,KAAM,WACNC,SAAU,UACVC,MAAO,MACPC,OAAQ,UCIJC,EAAiB,CACrBC,IAAK,SACLC,IAAK,WAaDC,EACK,CACPC,QAAS,gBACTC,SAAU,CAAC,GAAI,IACfC,WAAY,CAAC,GAAI,KASfC,EAAMC,EAAED,IAAI,cAEZE,EAAiBD,EAAEE,aAEnBC,EAAcH,EAAEI,KAXd,CACJR,QAAS,qBACTC,SAAU,CAAC,GAAI,IACfC,WAAY,CAAC,GAAI,MASfO,EAAaL,EAAEM,OAAOd,EAAgB,CAC1CY,KAAMD,EACNI,aA9BoB,MA4ChBC,EAAuBC,IAC3B,MAAMC,EAAWD,EAAIE,OAAOC,YAE5BC,EAAWH,IAWPI,EAAsB,KAC1BT,EAAWU,SAASC,SAEpBX,EAAWY,GAAG,UAAWT,IAQrBU,EAAiBC,IACrB,MAAMC,EAAUpB,EAAEI,KAAKT,GAEvBwB,EAAIE,SAASC,IACX,MAAMC,EDrDiB,GAAEC,SAAQtC,YACnC,MACMuC,EADmBlD,SAASC,cAAc,SAASkD,QACvBlD,cAAc,UAAUmD,WAAU,GAE9DC,EAAQH,EAASjD,cAAc,iBAC/BqD,EAAUJ,EAASjD,cAAc,yBACjCsD,EAAQL,EAASjD,cAAc,uBAC/BuD,EAAON,EAASjD,cAAc,gBAC9BwD,EAAWP,EAASjD,cAAc,0BAClCyD,EAAOR,EAASjD,cAAc,sBAC9B0D,EAAcT,EAASjD,cAAc,uBACrC2D,EAAUV,EAASjD,cAAc,mBACjC4D,EAAQX,EAASjD,cAAc,iBAC/B6D,EAASZ,EAASjD,cAAc,kBActC,OAZAoD,EAAMU,YAAcpD,EAAM0C,MAC1BC,EAAQS,YAAcpD,EAAM2C,QAC5BC,EAAMQ,YAAc,GAAGpD,EAAM4C,eAC7BC,EAAKO,YAAcnD,EAASD,EAAM6C,MAClCC,EAASM,YAAc,GAAG1E,EAAc,OAAQsB,EAAMqD,cAAc3E,EAAc,QAASsB,EAAMsD,UACjGP,EAAKK,YAAc,eAAepD,EAAMuD,qBAAqBvD,EAAMwD,WACnER,EAAYI,YAAcpD,EAAMgD,YAChCG,EAAOM,IAAMnB,EAAOa,OAEpBF,EAAQS,YAlDkB,EAACT,EAASU,KACpC,MAAMC,EAAWvE,SAASwE,yBAE1B,IAAK,IAAIhB,KAAQc,EAAc,CAC7B,MAAMG,EAAcb,EAAQR,WAAU,GAEtCqB,EAAYC,UAAUC,IAAI,mBAAmBnB,KAC7Ce,EAASK,YAAYH,GAGvB,OAAOF,GAwCaM,CAAoBjB,EAASjD,EAAMmE,WACvDjB,EAAMQ,YAtCkB,EAACR,EAAOkB,KAChC,MAAMR,EAAWvE,SAASwE,yBAE1B,IAAK,IAAIQ,KAAQD,EAAY,CAC3B,MAAME,EAAYpB,EAAMT,WAAU,GAElC6B,EAAUb,IAAMY,EAChBT,EAASK,YAAYK,GAGvB,OAAOV,GA4BWW,CAAkBrB,EAAOlD,EAAMwE,SAE1CjC,GC0BQ,CAAmBH,GAC1BhB,EAASN,EAAEM,OAAOgB,EAAGZ,SAAU,CACnCN,KAAMgB,IAGRd,EAAOqD,UAAUpC,GACjBtB,EAAe2D,SAAStD,MAG1BL,EAAe4D,MAAM9D,ICtEjB+D,EAAeC,IACnB,MAAMtC,EApBc,CAACsC,IACrB,MACMtC,EADmBlD,SAASC,cAAc,IAAMuF,GAAMrC,QAC1BlD,cAAc,IAAMuF,GAAMpC,WAAU,GAEhEqC,EAAuBvD,KLcZ,CAACA,GAAoB,WAAZA,EAAI5C,KAAgC,QAAZ4C,EAAI5C,IKdjBoG,CAAWxD,IAAOyD,IAEjDA,EAAe,KACnBzC,EAAS0C,SACT5F,SAAS6F,oBAAoB,UAAWJ,IAGpCK,EAAiBH,EAKvB,OAHAzC,EAAS6C,iBAAiB,QAASD,GACnC9F,SAAS+F,iBAAiB,UAAWN,GAE9BvC,GAIU8C,CAAcR,GAE/BxF,SAASC,cAAc,QAAQ2E,YAAY1B,ICZvC+C,EAAiB,CACrB,EAAK,CAAC,KACN,EAAK,CAAC,IAAK,KACX,EAAK,CAAC,IAAK,IAAK,KAChB,IAAO,CAAC,MAGJC,EAAe,CACnB,YACA,cAMIC,EAAY,CAChBrF,SAAU,EACVD,KAAM,IACNE,MAAO,IACPC,OAAQ,KAGJoF,EAASpG,SAASC,cAAc,YAChCoG,EAAmBD,EAAOjG,SAC1BmG,EAAeF,EAAOnG,cAAc,YACpC,EAAamG,EAAOnG,cAAc,UAClC,EAAYmG,EAAOnG,cAAc,SACjCsG,EAAcH,EAAOnG,cAAc,WACnCuG,EAAeJ,EAAOnG,cAAc,YACpCwG,EAAkBL,EAAOnG,cAAc,gBACvCyG,EAAgBN,EAAOnG,cAAc,aACrC0G,EAAcP,EAAOnG,cAAc,WACnC2G,EAAaR,EAAOnG,cAAc,WAClC4G,EAAgBT,EAAOnG,cAAc,gCACrC6G,EAAeV,EAAOnG,cAAc,mBA0DpCqC,EAAa,EAAEpB,MAAKC,UACxBmF,EAAa5F,MAAQ,GAAGQ,EAAI6F,QA/FP,OA+FmC5F,EAAI4F,QA/FvC,MAkGjBC,EAAW,KACf,MAAMzD,EAAQ4C,EAAU,EAAUzF,OAElC,EAAWuG,IAAM1D,EACjB,EAAW2D,YAAc3D,GAGrB4D,EAAY3B,IAChBD,EAAYC,GACZjD,IAEA6D,EAAO1B,UAAUkB,OAAO,kBAGpBwB,EAAc,KAClBhB,EAAOiB,QJ1FqBtH,EAAWsH,QE0BLvF,EAAWwF,UAAUrG,GEoEvDsG,IACAC,IAEAC,YAAW,KACTnF,EAAWrB,GACX+F,QAIEU,EAAqB,KACzB,MAAMC,EAAalB,EAAgB/F,MAC7B+C,EAAWiD,EAAchG,MAEzBuD,EAASgC,EAAe0B,GACxBC,EAAY3D,EAAOA,EAAO4D,OAAS,GAGzC,GAFqB5D,EAAO6D,SAASrE,GAGnCgD,EAAgBsB,kBAAkB,QAC7B,CACL,MAAMC,EAAY,uBAAsC,QAAfL,EAAwB,gBAAkB,mBAAqBtI,EAAc,QAASuI,IAE/HnB,EAAgBsB,kBAAkBC,GAGpCvB,EAAgBwB,kBAGZC,EAAY,EAAE9F,UAAS+F,KAC3B,MAAMC,EAAOhG,EAAOiG,MAAM,GAG1B,GAFiBnC,EAAa4B,SAASM,EAAK5E,MAE9B,CACZ,MAAM8E,EAAS,IAAIC,WAEnBD,EAAOvC,iBAAiB,QAAQ,IAAMoC,EAAOG,EAAOE,UAEpDF,EAAOG,cAAcL,KAInBb,EAAmB,CAACnD,EAhJC,yBAiJzByC,EAAczC,IAAMA,GAGhBoD,EAAmBpD,IAErB0C,EAAa4B,MAAMC,WADjBvE,EAC8B,gBAA+BA,+BAKjC,WLnLf,IAACwE,EAAWC,EKgDT,MACpBzC,EAAO1B,UAAUC,IAAI,qBAErB,IAAK,IAAImE,KAAYzC,EACnByC,EAASC,UAAW,GCjCxBC,GLL0B,MACxBjJ,EAAW2E,UAAUC,IAAI,0BAEzB,IAAK,IAAIsE,KAAU/I,EACjB+I,EAAOF,UAAW,GKEtBG,GHuBE1H,EAAIkB,GAAG,QAAQ,KEaI,MACnB0D,EAAO1B,UAAUkB,OAAO,qBAExB,IAAK,IAAIkD,KAAYzC,EACnByC,EAASC,UAAW,EAGtB,MAAMI,EAAgB/B,EAChBgC,EAAqB1B,EACrB2B,EAAmB3B,EACnB4B,EAAetC,EAIrBP,EAAgBV,iBAAiB,SAAUqD,GAC3C1C,EAAcX,iBAAiB,SAAUsD,GACzC1C,EAAYZ,iBAAiB,UALL7D,GAAQgG,EAAUhG,EAAKqF,KAM/CX,EAAWb,iBAAiB,UALL7D,GAAQgG,EAAUhG,EAAKsF,KAM9C,EAAUzB,iBAAiB,SAAUuD,GAErC/C,EAAYR,iBAAiB,UAAU,KACrCS,EAAa9F,MAAQ6F,EAAY7F,SAGnC8F,EAAaT,iBAAiB,UAAU,KACtCQ,EAAY7F,MAAQ8F,EAAa9F,SAGnC0F,EAAOL,iBAAiB,UAAW7D,IL/Ed,IAAC0G,EAAWC,EAAQU,EKgFvCrH,EAAIsH,iBFvBN1H,EAAWU,SAASiH,UAEpB3H,EAAW4H,IAAI,UAAWzH,GEyBxBmE,EAAO1B,UAAUC,IAAI,iBLpFDiE,EKuFlB,KACEzB,EDhGF,WCiGEC,KLzF2ByB,EK2F7B,IAAM1B,EDlGH,SJOkCoC,EK4FrC,IAAII,SAASzH,EAAIE,QL5F6BwH,MAAMlK,EAAY,CACpEmK,OAAQ,OACRN,SACCO,MAAMC,GAAcA,EAAW,GAAInB,IAAcjJ,EAAWoK,KAC5DC,MAAMnB,MK4FPzC,EAAOL,iBAAiB,QAASoD,IFzD/Bc,GACA3H,EAAWrB,MAGbO,EAAI0I,QAAQjJ,EApCN,IAsCNQ,EAAE0I,UArCG,qDACC,CACJC,YAAa,4FAmCgC9E,MAAM9D,GAwBrDM,EAAWwD,MAAM9D,GACjBe,IH3EkBqG,EM0BjByB,IACC,MAKMC,EPVO,EAACC,EAAIC,KACpB,IAAIC,EAEJ,MAAO,IAAIC,KACTC,aAAaF,GAEbA,EAAchD,WAAW8C,EOXN,OPWsBG,KOINE,EALT,KLoCZ,IAAChI,EE+BYlB,EAAemJ,cGhExClI,GLiCaC,EKjCWyH,ELiCHzH,EAAIqG,QAAQlG,IACrC,MAAM,KACJS,EAAI,MACJD,EAAK,MACLS,EAAK,OACLC,EAAM,SACNa,GACE/B,EAAGpC,MAEP,OAAOF,EAAcL,EAAWoD,IAhCZ,CAACD,IACrB,MAAMuH,EAAgBzK,EAAWK,MAEjC,OAAQoK,GACN,IA5CG,MA6CD,OAAOvH,EAjDK,IAkDd,IA7CM,SA8CJ,OAAOA,GAnDK,KAmDiBA,GAlDhB,IAmDf,IA9CI,OA+CF,OAAOA,EApDM,IAqDf,IAxDe,MAyDb,OAAO,EACT,QACE,MAAM,IAAIzD,MAAM,yBAAyBgL,OAoBtCC,CAAcxH,IACd9C,EAAcH,EAAY0D,IAC1BvD,EAAcF,EAAa0D,IAlBX,CAACa,GAGjB,IAFiBtE,EAAcwK,iBAAiB,kBAE3BC,OAAOC,GAAUpG,EAASgD,SAASoD,EAAMxK,SAgB9DyK,CAAiBrG,OK9CUsG,MAAM,EAdzB,QAkBbzI,EAAc0H,EAAKe,MAAM,EAlBZ,KLMQ,EAACC,EAAUC,KAClCvL,EAAW2E,UAAUkB,OAAO,0BAE5B,IAAK,IAAIqD,KAAU/I,EACjB+I,EAAOF,UAAW,EAGpBhJ,EAAWgG,iBAAiB,SAAUsF,GACtCtL,EAAWgG,iBAAiB,QAASuF,IKKnCC,CAAiBjB,EAA4BA,INnClBzB,EMqC7B,IAAMtD,EFtCE,kBJCgCqE,MAAMlK,EAAa,QAC1DoK,MAAMC,GAAcA,EAAW,GAAIA,EAASyB,OAAS7L,EAAWoK,KAChED,KAAKlB,GACLoB,MAAMnB,I","file":"main.bundle.js","sourcesContent":["const PluralWords = {\n  ROOM: [\n    'комната',\n    'комнаты',\n    'комнат',\n  ],\n  GUEST: [\n    'гостя',\n    'гостей',\n    'гостей',\n  ],\n};\n\nconst pluralizeWord = (key, count = 1) => {\n  const array = PluralWords[key];\n  let element = array[2];\n\n  if (count === 1) {\n    element = array[0];\n  } else if (count > 1 && count < 5) {\n    element = array[1];\n  }\n\n  return `${count} ${element}`;\n};\n\nconst isEscEvent = (evt) => evt.key === 'Escape' || evt.key === 'Esc';\n\nconst debounce = (cb, timeout) => {\n  let lastTimeout;\n\n  return (...args) => {\n    clearTimeout(lastTimeout);\n\n    lastTimeout = setTimeout(cb, timeout, ...args);\n  };\n};\n\nexport {\n  pluralizeWord,\n  isEscEvent,\n  debounce\n};\n","const SERVER_URL = 'https://22.javascript.pages.academy/keksobooking/';\n\nconst throwError = ({status, statusText}) => {\n  throw new Error(`${status} ${statusText}`);\n};\n\nconst getAdsData = (onSuccess, onFail) => fetch(SERVER_URL + 'data')\n  .then((response) => (response.ok) ? response.json() : throwError(response))\n  .then(onSuccess)\n  .catch(onFail);\n\nconst sendAdFormData = (onSuccess, onFail, body) => fetch(SERVER_URL, {\n  method: 'POST',\n  body,\n}).then((response) => (response.ok) ? onSuccess() : throwError(response))\n  .catch(onFail);\n\nexport {\n  getAdsData,\n  sendAdFormData\n};\n","const ANY_OPTION = 'any';\n\nconst LOW_PRICE = 10000;\nconst HIGH_PRICE = 50000;\n\nconst PriceOptions = {\n  LOW: 'low',\n  MIDDLE: 'middle',\n  HIGH: 'high',\n  ANY: ANY_OPTION,\n};\n\nconst filterForm = document.querySelector('.map__filters');\nconst filterChildren = filterForm.children;\nconst fieldType = filterForm.querySelector('#housing-type');\nconst fieldPrice = filterForm.querySelector('#housing-price');\nconst fieldRooms = filterForm.querySelector('#housing-rooms');\nconst fieldGuests = filterForm.querySelector('#housing-guests');\nconst fieldFeatures = filterForm.querySelector('#housing-features');\n\nconst disableFilterForm = () => {\n  filterForm.classList.add('map__filters--disabled');\n\n  for (let filter of filterChildren) {\n    filter.disabled = true;\n  }\n};\n\nconst enableFilterForm = (onChange, onReset) => {\n  filterForm.classList.remove('map__filters--disabled');\n\n  for (let filter of filterChildren) {\n    filter.disabled = false;\n  }\n\n  filterForm.addEventListener('change', onChange);\n  filterForm.addEventListener('reset', onReset);\n};\n\nconst resetFilterForm = () => filterForm.reset();\n\nconst filterByValue = ({value}, offer) => {\n  return value === ANY_OPTION ||\n         offer === ((typeof offer === 'number') ? +value : value);\n};\n\nconst filterByPrice = (price) => {\n  const selectedPrice = fieldPrice.value;\n\n  switch (selectedPrice) {\n    case PriceOptions.LOW:\n      return price < LOW_PRICE;\n    case PriceOptions.MIDDLE:\n      return price >= LOW_PRICE && price <= HIGH_PRICE;\n    case PriceOptions.HIGH:\n      return price > HIGH_PRICE;\n    case PriceOptions.ANY:\n      return true;\n    default:\n      throw new Error(`Неизвестное значение: ${selectedPrice}`);\n  }\n};\n\nconst filterByFeatures = (features) => {\n  const checkedFeatures = fieldFeatures.querySelectorAll('input:checked');\n\n  return [...checkedFeatures].every((input) => features.includes(input.value));\n};\n\nconst filterAds = (ads) => ads.filter((ad) => {\n  const {\n    type,\n    price,\n    rooms,\n    guests,\n    features,\n  } = ad.offer;\n\n  return filterByValue(fieldType, type) &&\n         filterByPrice(price) &&\n         filterByValue(fieldRooms, rooms) &&\n         filterByValue(fieldGuests, guests) &&\n         filterByFeatures(features);\n});\n\nexport {\n  enableFilterForm,\n  disableFilterForm,\n  resetFilterForm,\n  filterAds\n};\n","import {pluralizeWord} from './utils.js';\n\nconst typeList = {\n  flat: 'Квартира',\n  bungalow: 'Бунгало',\n  house: 'Дом',\n  palace: 'Дворец',\n};\n\nconst createOfferFeatures = (feature, typeFeatures) => {\n  const fragment = document.createDocumentFragment();\n\n  for (let type of typeFeatures) {\n    const featureCopy = feature.cloneNode(true);\n\n    featureCopy.classList.add(`popup__feature--${type}`);\n    fragment.appendChild(featureCopy);\n  }\n\n  return fragment;\n};\n\nconst createOfferPhotos = (photo, linkPhotos) => {\n  const fragment = document.createDocumentFragment();\n\n  for (let link of linkPhotos) {\n    const photoCopy = photo.cloneNode(true);\n\n    photoCopy.src = link;\n    fragment.appendChild(photoCopy);\n  }\n\n  return fragment;\n};\n\nconst createPropertyCard = ({author, offer}) => {\n  const templateFragment = document.querySelector('#card').content;\n  const template = templateFragment.querySelector('.popup').cloneNode(true);\n\n  const title = template.querySelector('.popup__title');\n  const address = template.querySelector('.popup__text--address');\n  const price = template.querySelector('.popup__text--price');\n  const type = template.querySelector('.popup__type');\n  const capacity = template.querySelector('.popup__text--capacity');\n  const time = template.querySelector('.popup__text--time');\n  const description = template.querySelector('.popup__description');\n  const feature = template.querySelector('.popup__feature');\n  const photo = template.querySelector('.popup__photo');\n  const avatar = template.querySelector('.popup__avatar');\n\n  title.textContent = offer.title;\n  address.textContent = offer.address;\n  price.textContent = `${offer.price} ₽/ночь`;\n  type.textContent = typeList[offer.type];\n  capacity.textContent = `${pluralizeWord('ROOM', offer.rooms)} для ${pluralizeWord('GUEST', offer.guests)}`;\n  time.textContent = `Заезд после ${offer.checkin}, выезд до ${offer.checkout}`;\n  description.textContent = offer.description;\n  avatar.src = author.avatar;\n\n  feature.replaceWith(createOfferFeatures(feature, offer.features));\n  photo.replaceWith(createOfferPhotos(photo, offer.photos));\n\n  return template;\n};\n\nexport default createPropertyCard;\n","/* global L:readonly */\n/* eslint no-undef: \"error\" */\n\nimport createPropertyCard from './property-card.js';\n\nimport {\n  enableAdForm,\n  setAddress\n} from './form.js';\n\nconst INITIAL_COORDS = {\n  lat: 35.68951,\n  lng: 139.69171,\n};\n\nconst MARKER_ZINDEX = 1000;\n\nconst MapSettings = {\n  ZOOM: 10,\n  URL: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  ATTR: {\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  },\n};\n\nconst PinsSettings = {\n  DEFAULT: {\n    iconUrl: './img/pin.svg',\n    iconSize: [36, 36],\n    iconAnchor: [18, 36],\n  },\n  MAIN: {\n    iconUrl: './img/main-pin.svg',\n    iconSize: [52, 52],\n    iconAnchor: [26, 52],\n  },\n};\n\nconst map = L.map('map-canvas');\n\nconst defaultMarkers = L.layerGroup();\n\nconst mainPinIcon = L.icon(PinsSettings.MAIN);\nconst mainMarker = L.marker(INITIAL_COORDS, {\n  icon: mainPinIcon,\n  zIndexOffset: MARKER_ZINDEX,\n});\n\nconst initializeMap = () => {\n  map.on('load', () => {\n    enableAdForm();\n    setAddress(INITIAL_COORDS);\n  });\n\n  map.setView(INITIAL_COORDS, MapSettings.ZOOM);\n\n  L.tileLayer(MapSettings.URL, MapSettings.ATTR).addTo(map);\n};\n\nconst onMainMarkerMoveend = (evt) => {\n  const location = evt.target.getLatLng();\n\n  setAddress(location);\n};\n\nconst resetCoordsMainMarker = () => mainMarker.setLatLng(INITIAL_COORDS);\n\nconst disableMapMainMarker = () => {\n  mainMarker.dragging.disable();\n\n  mainMarker.off('moveend', onMainMarkerMoveend);\n};\n\nconst enableMapMainMarker = () => {\n  mainMarker.dragging.enable();\n\n  mainMarker.on('moveend', onMainMarkerMoveend);\n};\n\nconst addMapMainMarker = () => {\n  mainMarker.addTo(map);\n  enableMapMainMarker();\n};\n\nconst addMapMarkers = (ads) => {\n  const pinIcon = L.icon(PinsSettings.DEFAULT);\n\n  ads.forEach((ad) => {\n    const card = createPropertyCard(ad);\n    const marker = L.marker(ad.location, {\n      icon: pinIcon,\n    });\n\n    marker.bindPopup(card);\n    defaultMarkers.addLayer(marker);\n  });\n\n  defaultMarkers.addTo(map);\n};\n\nconst removeMapMarkers = () => defaultMarkers.clearLayers();\n\nexport {\n  INITIAL_COORDS,\n  initializeMap,\n  addMapMainMarker,\n  addMapMarkers,\n  disableMapMainMarker,\n  enableMapMainMarker,\n  resetCoordsMainMarker,\n  removeMapMarkers\n};\n","import {isEscEvent} from './utils.js';\n\nconst Templates = {\n  OK: 'success',\n  ERROR: 'error',\n  FAILED: 'request-failed',\n};\n\nconst createMessage = (name) => {\n  const templateFragment = document.querySelector('#' + name).content;\n  const template = templateFragment.querySelector('.' + name).cloneNode(true);\n\n  const onMessageEscKeydown = (evt) => isEscEvent(evt) ? closeMessage() : false;\n\n  const closeMessage = () => {\n    template.remove();\n    document.removeEventListener('keydown', onMessageEscKeydown);\n  };\n\n  const onMessageClick = closeMessage;\n\n  template.addEventListener('click', onMessageClick);\n  document.addEventListener('keydown', onMessageEscKeydown);\n\n  return template;\n};\n\nconst showMessage = (name) => {\n  const template = createMessage(name);\n\n  document.querySelector('main').appendChild(template);\n};\n\nexport {\n  Templates,\n  showMessage\n};\n","import {pluralizeWord} from './utils.js';\nimport {sendAdFormData} from './api.js';\nimport {resetFilterForm} from './filter.js';\n\nimport {\n  INITIAL_COORDS,\n  resetCoordsMainMarker,\n  disableMapMainMarker,\n  enableMapMainMarker\n} from './map.js';\n\nimport {\n  Templates,\n  showMessage\n} from './message.js';\n\nconst ADDRESS_DIGITS = 5;\n\nconst ROOMS_CAPACITY = {\n  '1': ['1'],\n  '2': ['1', '2'],\n  '3': ['1', '2', '3'],\n  '100': ['0'],\n};\n\nconst FILE_FORMATS = [\n  'image/png',\n  'image/jpeg',\n];\n\nconst DEFAULT_AVATAR_URL = 'img/muffin-grey.svg';\nconst DEFAULT_PHOTO_COLOR = '#e4e4de';\n\nconst priceList = {\n  bungalow: 0,\n  flat: 1000,\n  house: 5000,\n  palace: 10000,\n};\n\nconst adForm = document.querySelector('.ad-form');\nconst fieldsetChildren = adForm.children;\nconst fieldAddress = adForm.querySelector('#address');\nconst fieldPrice = adForm.querySelector('#price');\nconst fieldType = adForm.querySelector('#type');\nconst fieldTimein = adForm.querySelector('#timein');\nconst fieldTimeout = adForm.querySelector('#timeout');\nconst fieldRoomNumber = adForm.querySelector('#room_number');\nconst fieldCapacity = adForm.querySelector('#capacity');\nconst fieldAvatar = adForm.querySelector('#avatar');\nconst fieldPhoto = adForm.querySelector('#images');\nconst previewAvatar = adForm.querySelector('.ad-form-header__preview img');\nconst previewPhoto = adForm.querySelector('.ad-form__photo');\n\nconst disableAdForm = () => {\n  adForm.classList.add('ad-form--disabled');\n\n  for (let fieldset of fieldsetChildren) {\n    fieldset.disabled = true;\n  }\n};\n\nconst enableAdForm = () => {\n  adForm.classList.remove('ad-form--disabled');\n\n  for (let fieldset of fieldsetChildren) {\n    fieldset.disabled = false;\n  }\n\n  const onAdFormReset = resetAdForm;\n  const onRoomNumberChange = checkCapacityRooms;\n  const onCapacityChange = checkCapacityRooms;\n  const onTypeChange = setPrice;\n  const onAvatarChange = (evt) => imageLoad(evt, setAvatarPreview);\n  const onPhotoChange = (evt) => imageLoad(evt, setPhotoPreview);\n\n  fieldRoomNumber.addEventListener('change', onRoomNumberChange);\n  fieldCapacity.addEventListener('change', onCapacityChange);\n  fieldAvatar.addEventListener('change', onAvatarChange);\n  fieldPhoto.addEventListener('change', onPhotoChange);\n  fieldType.addEventListener('change', onTypeChange);\n\n  fieldTimein.addEventListener('change', () => {\n    fieldTimeout.value = fieldTimein.value;\n  });\n\n  fieldTimeout.addEventListener('change', () => {\n    fieldTimein.value = fieldTimeout.value;\n  });\n\n  adForm.addEventListener('submit', (evt) => {\n    evt.preventDefault();\n\n    disableMapMainMarker();\n\n    adForm.classList.add('ad-form--load');\n\n    sendAdFormData(\n      () => {\n        submitAd(Templates.OK);\n        resetAdForm();\n      },\n      () => submitAd(Templates.ERROR),\n      new FormData(evt.target),\n    );\n  });\n\n  adForm.addEventListener('reset', onAdFormReset);\n};\n\nconst setAddress = ({lat, lng}) => {\n  fieldAddress.value = `${lat.toFixed(ADDRESS_DIGITS)}, ${lng.toFixed(ADDRESS_DIGITS)}`;\n};\n\nconst setPrice = () => {\n  const price = priceList[fieldType.value];\n\n  fieldPrice.min = price;\n  fieldPrice.placeholder = price;\n};\n\nconst submitAd = (name) => {\n  showMessage(name);\n  enableMapMainMarker();\n\n  adForm.classList.remove('ad-form--load');\n};\n\nconst resetAdForm = () => {\n  adForm.reset();\n\n  resetFilterForm();\n  resetCoordsMainMarker();\n  setAvatarPreview();\n  setPhotoPreview();\n\n  setTimeout(() => {\n    setAddress(INITIAL_COORDS);\n    setPrice();\n  });\n};\n\nconst checkCapacityRooms = () => {\n  const roomNumber = fieldRoomNumber.value;\n  const capacity = fieldCapacity.value;\n\n  const guests = ROOMS_CAPACITY[roomNumber];\n  const maxGuests = guests[guests.length - 1];\n  const flagCapacity = guests.includes(capacity);\n\n  if (flagCapacity) {\n    fieldRoomNumber.setCustomValidity('');\n  } else {\n    const textError = `Вариант размещения ${(roomNumber === '100') ? 'не для гостей' : 'вместимостью до ' + pluralizeWord('GUEST', maxGuests)}`;\n\n    fieldRoomNumber.setCustomValidity(textError);\n  }\n\n  fieldRoomNumber.reportValidity();\n};\n\nconst imageLoad = ({target}, onLoad) => {\n  const file = target.files[0];\n  const flagType = FILE_FORMATS.includes(file.type);\n\n  if (flagType) {\n    const reader = new FileReader();\n\n    reader.addEventListener('load', () => onLoad(reader.result));\n\n    reader.readAsDataURL(file);\n  }\n};\n\nconst setAvatarPreview = (src = DEFAULT_AVATAR_URL) => {\n  previewAvatar.src = src;\n};\n\nconst setPhotoPreview = (src) => {\n  if (src) {\n    previewPhoto.style.background = `${DEFAULT_PHOTO_COLOR} url('${src}') no-repeat center / cover`;\n\n    return;\n  }\n\n  previewPhoto.style.background = `${DEFAULT_PHOTO_COLOR}`;\n};\n\nexport {\n  enableAdForm,\n  disableAdForm,\n  setAddress\n};\n","import {debounce} from './utils.js';\nimport {getAdsData} from './api.js';\nimport {disableAdForm} from './form.js';\n\nimport {\n  disableFilterForm,\n  enableFilterForm,\n  filterAds\n} from './filter.js';\n\nimport {\n  Templates,\n  showMessage\n} from './message.js';\n\nimport {\n  initializeMap,\n  addMapMainMarker,\n  addMapMarkers,\n  removeMapMarkers\n} from './map.js';\n\nconst AD_COUNT = 10;\nconst RERENDER_DELAY = 500;\n\ndisableAdForm();\ndisableFilterForm();\n\ninitializeMap();\naddMapMainMarker();\n\ngetAdsData(\n  (data) => {\n    const refreshFilterForm = () => {\n      removeMapMarkers();\n\n      addMapMarkers(filterAds(data).slice(0, AD_COUNT));\n    };\n    const debouncedRefreshFilterForm = debounce(refreshFilterForm, RERENDER_DELAY);\n\n    addMapMarkers(data.slice(0, AD_COUNT));\n    enableFilterForm(debouncedRefreshFilterForm, debouncedRefreshFilterForm);\n  },\n  () => showMessage(Templates.FAILED),\n);\n"],"sourceRoot":""}